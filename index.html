<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اردو اے آئی سکور کارڈ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Basic styles for body and container */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to right, #e0f2f7, #fef3c7); /* Subtle gradient background */
            color: #1f2937;
            line-height: 1.6;
            direction: rtl;
            text-align: right;
            min-height: 100vh;
            padding: 20px 0;
        }
        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 30px;
            background-color: #ffffff;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15); /* More pronounced shadow */
            border-radius: 12px; /* More rounded corners */
            overflow: hidden; /* Clear floats */
        }

        /* Headings */
        h1, h2, h3 {
            color: #111827;
            margin-bottom: 20px;
            text-align: center; /* Center headings */
            font-weight: 700; /* Bold headings */
        }
         h1 { font-size: 2.5rem; }
         h2 { font-size: 2rem; }
         h3 { font-size: 1.5rem; }


        /* Form Elements */
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600; /* Slightly bolder labels */
            color: #374151; /* Darker gray for labels */
        }
        input[type="text"], input[type="date"], input[type="time"], input[type="number"], select {
            width: 100%;
            padding: 12px; /* Increased padding */
            margin-bottom: 20px; /* Increased margin */
            border: 1px solid #d1d5db;
            border-radius: 6px; /* Slightly more rounded */
            box-sizing: border-box;
            text-align: right;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
         input[type="text"]:focus, input[type="date"]:focus, input[type="time"]:focus, input[type="number"]:focus, select:focus {
             border-color: #3b82f6; /* Highlight on focus */
             box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3); /* Glow effect on focus */
             outline: none;
         }

        /* Buttons */
        button {
            background: linear-gradient(to right, #3b82f6, #2563eb); /* Gradient background */
            color: white;
            padding: 12px 20px; /* Increased padding */
            border: none;
            border-radius: 6px; /* Slightly more rounded */
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.2s ease; /* Smooth transitions */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Subtle shadow */
            display: inline-block; /* Allow side-by-side buttons */
            margin-right: 10px; /* Space between buttons */
        }
        button:hover {
            background: linear-gradient(to right, #2563eb, #1e40af); /* Darker gradient on hover */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* More pronounced shadow on hover */
            transform: translateY(-1px); /* Slight lift effect */
        }
        button:active {
             background: linear-gradient(to right, #1e40af, #1a237e); /* Even darker on active */
             box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
             transform: translateY(0); /* Reset lift */
        }
        button:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .remove-player-btn {
            background-color: #ef4444;
            margin-right: 0; /* Remove right margin for remove button */
            margin-left: 10px; /* Add left margin for RTL */
        }
        .remove-player-btn:hover {
            background-color: #dc2626;
        }

        /* Form Sections */
        .form-section {
            margin-bottom: 30px; /* Increased margin */
            padding: 20px; /* Increased padding */
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background-color: #f9fafb; /* Light background for sections */
        }

        /* Player List */
        .player-list {
            margin-top: 15px;
        }
        .player-input-group {
            display: flex;
            align-items: center;
            margin-bottom: 12px; /* Increased margin */
            flex-direction: row-reverse;
        }
        .player-input-group input {
            flex-grow: 1;
            margin-bottom: 0;
            margin-left: 10px;
            margin-right: 0;
        }

        /* Scoreboard Styles */
        #scoreboard {
            display: none;
        }
        .scoreboard-section {
            margin-bottom: 25px; /* Increased margin */
            padding: 20px; /* Increased padding */
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            text-align: right;
            transition: background-color 0.3s ease; /* Smooth color transition */
        }
         /* Team specific colors */
        .team-a-color {
            background-color: #e0f7fa; /* Lighter Cyan */
            border-color: #06b6d4; /* Cyan 500 */
        }
        .team-b-color {
            background-color: #fffbeb; /* Lighter Yellow */
            border-color: #facc15; /* Yellow 500 */
        }

        .score-display {
            font-size: 3rem; /* Larger score */
            font-weight: 700;
            margin-bottom: 15px;
            text-align: center;
            color: #047857; /* Green color for score */
        }
        .batsman-stats, .bowler-stats {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e5e7eb;
        }
        .batsman-stats div, .bowler-stats div {
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .run-buttons button {
            margin-left: 8px; /* Adjusted margin */
            margin-right: 0;
            padding: 10px 16px; /* Adjusted padding */
            font-size: 1.1rem;
        }
         .run-buttons button:last-child {
             margin-left: 0; /* Remove margin from last button */
         }

        .wicket-controls {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
        }
        .dismissal-details {
            margin-top: 15px;
            padding: 15px;
            background-color: #fef2f2; /* Light red background */
            border: 1px solid #f87171; /* Red border */
            border-radius: 6px;
        }
        .fall-of-wickets {
            margin-top: 25px;
        }
        .fall-of-wickets ul {
            list-style: none;
            padding: 0;
        }
        .fall-of-wickets li {
            margin-bottom: 8px;
            padding: 8px;
            border-bottom: 1px dotted #d1d5db;
            font-size: 0.95rem;
        }

        /* Target Score Display */
        #targetScoreDisplay {
            background-color: #fef2f2; /* Light red background */
            border: 2px solid #ef4444; /* Red border */
            color: #b91c1c; /* Dark red text */
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
            display: none; /* Hidden initially */
            float: left; /* Position on the left */
            clear: both; /* Clear floats above it */
            width: auto; /* Adjust width based on content */
            max-width: 200px; /* Max width */
            margin-left: 0;
            margin-right: auto; /* Push to the left in RTL */
        }


        /* Match Result / Scorecard Styles */
        #matchResult {
            display: none;
            margin-top: 30px;
            padding: 25px; /* Increased padding */
            border: 2px solid #10b981;
            border-radius: 12px; /* More rounded */
            background-color: #ecfdf5;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }
        .scorecard-section {
            margin-bottom: 25px;
        }
        .scorecard-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            direction: rtl;
        }
        .scorecard-table th, .scorecard-table td {
            border: 1px solid #d1d5db;
            padding: 10px; /* Increased padding */
            text-align: right;
        }
        .scorecard-table th {
            background-color: #e5e7eb; /* Lighter gray for headers */
            font-weight: 700;
        }
         .scorecard-table tbody tr:nth-child(even) {
             background-color: #f9fafb; /* Zebra striping */
         }

        /* Print Styles */
        @media print {
            body {
                background-color: #fff;
                color: #000;
                direction: rtl;
                text-align: right;
            }
            .container {
                box-shadow: none;
                margin: 0;
                padding: 0;
            }
            #preMatchForm, #scoreboard {
                display: none !important;
            }
            #matchResult {
                display: block !important;
                border: none;
                padding: 0;
                background-color: #fff;
                box-shadow: none;
            }
            button {
                display: none; /* Hide buttons in print */
            }
            h1, h2, h3 {
                color: #000;
                text-align: right;
            }
             .team-a-color, .team-b-color {
                 background-color: transparent !important;
                 border-color: #000 !important;
            }
             .scorecard-table th, .scorecard-table td {
                text-align: right;
             }
             #targetScoreDisplay {
                 display: block !important; /* Ensure target is visible in print */
                 float: none; /* Remove float in print */
                 margin: 20px auto; /* Center in print */
                 background-color: #fff; /* White background in print */
                 color: #000; /* Black text in print */
                 border-color: #000; /* Black border in print */
             }
        }
    </style>
</head>
<body>

<div class="container">
    <h1 class="text-3xl font-bold text-center mb-6">اردو اے آئی سکور کارڈ</h1>

    <div id="preMatchForm">
        <h2 class="text-2xl font-semibold mb-4">میچ کی تفصیلات</h2>
        <div class="form-section">
            <label for="matchTitle">میچ کا عنوان:</label>
            <input type="text" id="matchTitle" value="مقامی کلب فائنل">

            <label for="groundName">گراؤنڈ کا نام:</label>
            <input type="text" id="groundName" value="سٹی پارک گراؤنڈ">

            <label for="matchDate">تاریخ:</label>
            <input type="date" id="matchDate">

            <label for="matchTime">وقت:</label>
            <input type="time" id="matchTime">

            <label for="totalOvers">کل اوورز:</label>
            <input type="number" id="totalOvers" value="20" min="1">
        </div>

        <h2 class="text-2xl font-semibold mb-4">ٹیمیں اور کھلاڑی</h2>
        <div class="form-section">
            <label for="teamAName">ٹیم الف کا نام:</label>
            <input type="text" id="teamAName" value="ٹیم الف">
            <h3 class="text-xl font-medium mt-4 mb-2">ٹیم الف کے کھلاڑی:</h3>
            <div id="teamAPlayers" class="player-list">
                <div class="player-input-group"><input type="text" class="player-name" value="کھلاڑی الف 1"><button class="remove-player-btn">ہٹائیں</button></div>
                <div class="player-input-group"><input type="text" class="player-name" value="کھلاڑی الف 2"><button class="remove-player-btn">ہٹائیں</button></div>
                <div class="player-input-group"><input type="text" class="player-name" value="کھلاڑی الف 3"><button class="remove-player-btn">ہٹائیں</button></div>
                <div class="player-input-group"><input type="text" class="player-name" value="کھلاڑی الف 4"><button class="remove-player-btn">ہٹائیں</button></div>
                <div class="player-input-group"><input type="text" class="player-name" value="کھلاڑی الف 5"><button class="remove-player-btn">ہٹائیں</button></div>
                <div class="player-input-group"><input type="text" class="player-name" value="کھلاڑی الف 6"><button class="remove-player-btn">ہٹائیں</button></div>
                <div class="player-input-group"><input type="text" class="player-name" value="کھلاڑی الف 7"><button class="remove-player-btn">ہٹائیں</button></div>
                <div class="player-input-group"><input type="text" class="player-name" value="کھلاڑی الف 8"><button class="remove-player-btn">ہٹائیں</button></div>
                <div class="player-input-group"><input type="text" class="player-name" value="کھلاڑی الف 9"><button class="remove-player-btn">ہٹائیں</button></div>
                <div class="player-input-group"><input type="text" class="player-name" value="کھلاڑی الف 10"><button class="remove-player-btn">ہٹائیں</button></div>
                <div class="player-input-group"><input type="text" class="player-name" value="کھلاڑی الف 11"><button class="remove-player-btn">ہٹائیں</button></div>
            </div>
            <button id="addPlayerA" class="mt-2">کھلاڑی شامل کریں</button>
        </div>

        <div class="form-section">
            <label for="teamBName">ٹیم با کا نام:</label>
            <input type="text" id="teamBName" value="ٹیم با">
            <h3 class="text-xl font-medium mt-4 mb-2">ٹیم با کے کھلاڑی:</h3>
            <div id="teamBPlayers" class="player-list">
                 <div class="player-input-group"><input type="text" class="player-name" value="کھلاڑی با 1"><button class="remove-player-btn">ہٹائیں</button></div>
                <div class="player-input-group"><input type="text" class="player-name" value="کھلاڑی با 2"><button class="remove-player-btn">ہٹائیں</button></div>
                <div class="player-input-group"><input type="text" class="player-name" value="کھلاڑی با 3"><button class="remove-player-btn">ہٹائیں</button></div>
                <div class="player-input-group"><input type="text" class="player-name" value="کھلاڑی با 4"><button class="remove-player-btn">ہٹائیں</button></div>
                <div class="player-input-group"><input type="text" class="player-name" value="کھلاڑی با 5"><button class="remove-player-btn">ہٹائیں</button></div>
                <div class="player-input-group"><input type="text" class="player-name" value="کھلاڑی با 6"><button class="remove-player-btn">ہٹائیں</button></div>
                <div class="player-input-group"><input type="text" class="player-name" value="کھلاڑی با 7"><button class="remove-player-btn">ہٹائیں</button></div>
                <div class="player-input-group"><input type="text" class="player-name" value="کھلاڑی با 8"><button class="remove-player-btn">ہٹائیں</button></div>
                <div class="player-input-group"><input type="text" class="player-name" value="کھلاڑی با 9"><button class="remove-player-btn">ہٹائیں</button></div>
                <div class="player-input-group"><input type="text" class="player-name" value="کھلاڑی با 10"><button class="remove-player-btn">ہٹائیں</button></div>
                <div class="player-input-group"><input type="text" class="player-name" value="کھلاڑی با 11"><button class="remove-player-btn">ہٹائیں</button></div>
            </div>
            <button id="addPlayerB" class="mt-2">کھلاڑی شامل کریں</button>
        </div>

        <h2 class="text-2xl font-semibold mb-4">امپائر</h2>
        <div class="form-section">
            <label for="umpireOnField1">آن فیلڈ امپائر 1:</label>
            <input type="text" id="umpireOnField1" value="امپائر 1">

            <label for="umpireOnField2">آن فیلڈ امپائر 2:</label>
            <input type="text" id="umpireOnField2" value="امپائر 2">

            <label for="umpireThird">تیسرا امپائر:</label>
            <input type="text" id="umpireThird" value="تیسرا امپائر">
        </div>

        <button id="startMatchBtn" class="w-full py-3 text-xl font-bold">میچ شروع کریں</button>
    </div>

    <div id="scoreboard">
        <h2 class="text-2xl font-semibold mb-4">میچ جاری ہے</h2>
        <div class="scoreboard-section">
            <p><strong>میچ:</strong> <span id="sb_matchTitle"></span></p>
            <p><strong>گراؤنڈ:</strong> <span id="sb_groundName"></span></p>
            <p><strong>تاریخ:</strong> <span id="sb_matchDate"></span></p>
            <p><strong>وقت:</strong> <span id="sb_matchTime"></span></p>
            <p><strong>کل اوورز:</strong> <span id="sb_totalOvers"></span></p>
            <p><strong>اننگز:</strong> <span id="sb_innings">1</span></p>
        </div>

         <div id="targetScoreDisplay">
            ہدف: <span id="sb_target_display"></span>
        </div>


        <div id="battingTeamSection" class="scoreboard-section">
            <h3 class="text-xl font-medium mb-2">بیٹنگ: <span id="sb_battingTeamName"></span></h3>
            <div class="score-display"><span id="sb_battingScore">0</span>/<span id="sb_wickets">0</span></div>
            <p>اوورز: <span id="sb_oversBowled">0.0</span> / <span id="sb_matchTotalOvers"></span></p>
            <p>CRR: <span id="sb_crr">0.00</span></p>
            <p id="rrrDisplay" style="display: none;">RRR: <span id="sb_rrr">0.00</span></p> <div class="batsman-stats mt-4">
                <label for="batsman1Select">بلے باز 1:</label>
                <select id="batsman1Select"></select>
                <div><span id="sb_batsman1Name"></span>: <span id="sb_batsman1Score">0</span> (<span id="sb_batsman1Balls">0</span>)</div>

                <label for="batsman2Select" class="mt-3">بلے باز 2:</label>
                <select id="batsman2Select"></select>
                <div><span id="sb_batsman2Name"></span>: <span id="sb_batsman2Score">0</span> (<span id="sb_batsman2Balls">0</span>)</div>
            </div>

            <div class="run-buttons mt-4">
                <button data-runs="1">+1</button>
                <button data-runs="2">+2</button>
                <button data-runs="3">+3</button>
                <button data-runs="4">+4</button>
                <button data-runs="6">+6</button>
            </div>
        </div>

        <div id="bowlingTeamSection" class="scoreboard-section">
            <h3 class="text-xl font-medium mb-2">باؤلنگ: <span id="sb_bowlingTeamName"></span></h3>
            <label for="bowlerSelect">موجودہ باؤلر:</label>
            <select id="bowlerSelect"></select>
            <div class="bowler-stats">
                <div><span id="sb_bowlerName"></span>: <span id="sb_bowlerOvers">0.0</span> - <span id="sb_bowlerWickets">0</span></div>
            </div>
            <div class="extras-buttons mt-4">
                <button id="noBallBtn">نو بال</button>
                <button id="wideBtn">وائیڈ</button>
            </div>
        </div>

        <div class="scoreboard-section wicket-controls">
            <h3 class="text-xl font-medium mb-2">وکٹ!</h3>
            <button id="wicketBtn">+وکٹ</button>
            <div id="dismissalDetails" class="dismissal-details" style="display: none;">
                <label for="batsmanOutSelect">آؤٹ ہونے والا بلے باز:</label>
                <select id="batsmanOutSelect"></select>

                <label for="dismissalMethodSelect" class="mt-3">آؤٹ ہونے کا طریقہ:</label>
                <select id="dismissalMethodSelect">
                    <option value="">طریقہ منتخب کریں</option>
                    <option value="Bold">بولڈ</option>
                    <option value="Lbw">ایل بی ڈبلیو</option>
                    <option value="Run Out">رن آؤٹ</option>
                    <option value="Stumped">اسٹمپڈ</option>
                    <option value="Caught">کیچ</option>
                    <option value="Hit Wicket">ہٹ وکٹ</option>
                    <option value="Obstructing the field">فیلڈ میں رکاوٹ</option>
                    <option value="Retired Hurt">ریٹائرڈ ہرٹ</option>
                </select>

                <div id="fielderSelectContainer" style="display: none;">
                    <label for="fielderSelect" class="mt-3">فیلڈر:</label>
                    <select id="fielderSelect"></select>
                </div>
                 <button id="confirmWicketBtn" class="mt-3">وکٹ کی تصدیق کریں</button>
            </div>
        </div>

        <div class="scoreboard-section fall-of-wickets">
             <h3 class="text-xl font-medium mb-2">وکٹوں کا زوال</h3>
             <ul id="fowList">
                 </ul>
        </div>

        <button id="endInningsBtn" class="w-full py-3 text-xl font-bold mt-4">اننگز ختم کریں</button>
    </div>

    <div id="matchResult">
        <h2 class="text-2xl font-semibold mb-4 text-center">میچ کا نتیجہ</h2>
         <div class="scoreboard-section">
            <p><strong>میچ:</strong> <span id="sr_matchTitle"></span></p>
            <p><strong>گراؤنڈ:</strong> <span id="sr_groundName"></span></p>
            <p><strong>تاریخ:</strong> <span id="sr_matchDate"></span></p>
            <p><strong>وقت:</strong> <span id="sr_matchTime"></span></p>
            <p><strong>کل اوورز:</strong> <span id="sr_totalOvers"></span></p>
             <p><strong>امپائر:</strong> آن فیلڈ 1: <span id="sr_umpireOnField1"></span>، آن فیلڈ 2: <span id="sr_umpaireOnField2"></span>، تیسرا: <span id="sr_umpireThird"></span></p>
        </div>

        <div id="innings1Scorecard" class="scorecard-section">
            <h3 class="text-xl font-medium mb-2"><span id="sr_innings1Team"></span> اننگز (<span id="sr_innings1Score"></span>/<span id="sr_innings1Wickets"></span> اوورز میں <span id="sr_innings1Overs"></span>)</h3>
             <h4>بیٹنگ:</h4>
             <table class="scorecard-table">
                 <thead>
                     <tr><th>بلے باز</th><th>رنز</th><th>گیندیں</th><th>آؤٹ ہونے کا طریقہ</th><th>فیلڈر</th></tr>
                 </thead>
                 <tbody id="sr_innings1Batting">
                     </tbody>
             </table>
             <h4 class="mt-4">باؤلنگ:</h4>
              <table class="scorecard-table">
                 <thead>
                     <tr><th>باؤلر</th><th>اوورز</th><th>وکٹیں</th><th>رنز</th></tr>
                 </thead>
                 <tbody id="sr_innings1Bowling">
                     </tbody>
             </table>
             <h4 class="mt-4">وکٹوں کا زوال:</h4>
             <ul id="sr_innings1FOW">
                 </ul>
        </div>

         <div id="innings2Scorecard" class="scorecard-section" style="display: none;">
            <h3 class="text-xl font-medium mb-2"><span id="sr_innings2Team"></span> اننگز (<span id="sr_innings2Score"></span>/<span id="sr_innings2Wickets"></span> اوورز میں <span id="sr_innings2Overs"></span>)</h3>
             <h4>بیٹنگ:</h4>
             <table class="scorecard-table">
                 <thead>
                     <tr><th>بلے باز</th><th>رنز</th><th>گیندیں</th><th>آؤٹ ہونے کا طریقہ</th><th>فیلڈر</th></tr>
                 </thead>
                 <tbody id="sr_innings2Batting">
                     </tbody>
             </table>
              <h4 class="mt-4">باؤلنگ:</h4>
              <table class="scorecard-table">
                 <thead>
                     <tr><th>باؤلر</th><th>اوورز</th><th>وکٹیں</th><th>رنز</th></tr>
                 </thead>
                 <tbody id="sr_innings2Bowling">
                     </tbody>
             </table>
              <h4 class="mt-4">وکٹوں کا زوال:</h4>
             <ul id="sr_innings2FOW">
                 </ul>
        </div>

        <h3 class="text-xl font-medium mb-2 mt-4">میچ کا نتیجہ: <span id="finalMatchResult"></span></h3>
        <p id="manOfTheMatch" class="text-lg font-semibold mt-2"></p>


        <button onclick="window.print()" class="w-full py-3 text-xl font-bold mt-4">سکور کارڈ پرنٹ/ایکسپورٹ کریں</button>
    </div>

</div>

<script>
    // --- Global State Variables ---
    let matchDetails = {};
    let teamA = { name: '', players: [], battingStats: {}, bowlingStats: {} };
    let teamB = { name: '', players: [], battingStats: {}, bowlingStats: {} };
    let currentInnings = 1;
    let battingTeam = null;
    let bowlingTeam = null;
    let totalOvers = 0;
    let currentScore = 0;
    let currentWickets = 0;
    let ballsInOver = 0;
    let completedOvers = 0;
    let currentBatsman1 = null; // Player name
    let currentBatsman2 = null; // Player name
    let currentBowler = null; // Player name
    let targetScore = null;
    let fallOfWickets = [];
    let innings1Data = null; // To store data after innings 1 ends

    // --- DOM Elements ---
    const preMatchForm = document.getElementById('preMatchForm');
    const scoreboard = document.getElementById('scoreboard');
    const matchResultDiv = document.getElementById('matchResult');

    const teamAPlayersDiv = document.getElementById('teamAPlayers');
    const teamBPlayersDiv = document.getElementById('teamBPlayers');
    const addPlayerABtn = document.getElementById('addPlayerA');
    const addPlayerBBtn = document.getElementById('addPlayerB');
    const startMatchBtn = document.getElementById('startMatchBtn');

    const sbMatchTitle = document.getElementById('sb_matchTitle');
    const sbGroundName = document.getElementById('sb_groundName');
    const sbMatchDate = document.getElementById('sb_matchDate');
    const sbMatchTime = document.getElementById('sb_matchTime');
    const sbTotalOvers = document.getElementById('sb_totalOvers');
    const sbInnings = document.getElementById('sb_innings');
    const sbBattingTeamName = document.getElementById('sb_battingTeamName');
    const sbBowlingTeamName = document.getElementById('sb_bowlingTeamName');
    const sbBattingScore = document.getElementById('sb_battingScore');
    const sbWickets = document.getElementById('sb_wickets');
    const sbOversBowled = document.getElementById('sb_oversBowled');
    const sbMatchTotalOvers = document.getElementById('sb_matchTotalOvers');
    const sbCrr = document.getElementById('sb_crr');
    const rrrDisplay = document.getElementById('rrrDisplay');
    const sbRrr = document.getElementById('sb_rrr');
    const sbTarget = document.getElementById('sb_target'); // This is the span inside the old RRR display

    const targetScoreDisplayDiv = document.getElementById('targetScoreDisplay'); // New target display div
    const sbTargetDisplay = document.getElementById('sb_target_display'); // Span inside the new target display

    const batsman1Select = document.getElementById('batsman1Select');
    const batsman2Select = document.getElementById('batsman2Select');
    const sbBatsman1Name = document.getElementById('sb_batsman1Name');
    const sbBatsman1Score = document.getElementById('sb_batsman1Score');
    const sbBatsman1Balls = document.getElementById('sb_batsman1Balls');
    const sbBatsman2Name = document.getElementById('sb_batsman2Name');
    const sbBatsman2Score = document.getElementById('sb_batsman2Score');
    const sbBatsman2Balls = document.getElementById('sb_batsman2Balls');

    const bowlerSelect = document.getElementById('bowlerSelect');
    const sbBowlerName = document.getElementById('sb_bowlerName');
    const sbBowlerOvers = document.getElementById('sb_bowlerOvers');
    const sbBowlerWickets = document.getElementById('sb_bowlerWickets');

    const runButtons = document.querySelectorAll('.run-buttons button');
    const wicketBtn = document.getElementById('wicketBtn');
    const noBallBtn = document.getElementById('noBallBtn');
    const wideBtn = document.getElementById('wideBtn');
    const endInningsBtn = document.getElementById('endInningsBtn');

    const dismissalDetailsDiv = document.getElementById('dismissalDetails');
    const batsmanOutSelect = document.getElementById('batsmanOutSelect');
    const dismissalMethodSelect = document.getElementById('dismissalMethodSelect');
    const fielderSelectContainer = document.getElementById('fielderSelectContainer');
    const fielderSelect = document.getElementById('fielderSelect');
    const confirmWicketBtn = document.getElementById('confirmWicketBtn');

    const fowList = document.getElementById('fowList');

    const srMatchTitle = document.getElementById('sr_matchTitle');
    const srGroundName = document.getElementById('sr_groundName');
    const srMatchDate = document.getElementById('sr_matchDate');
    const srMatchTime = document.getElementById('sr_matchTime');
    const srTotalOvers = document.getElementById('sr_totalOvers');
    const srUmpireOnField1 = document.getElementById('sr_umpireOnField1');
    const srUmpaireOnField2 = document.getElementById('sr_umpaireOnField2');
    const srUmpireThird = document.getElementById('sr_umpireThird');

    const innings1ScorecardDiv = document.getElementById('innings1Scorecard');
    const srInnings1Team = document.getElementById('sr_innings1Team');
    const srInnings1Score = document.getElementById('sr_innings1Score');
    const srInnings1Wickets = document.getElementById('sr_innings1Wickets');
    const srInnings1Overs = document.getElementById('sr_innings1Overs');
    const srInnings1Batting = document.getElementById('sr_innings1Batting');
    const srInnings1Bowling = document.getElementById('sr_innings1Bowling');
    const srInnings1FOW = document.getElementById('sr_innings1FOW');

    const innings2ScorecardDiv = document.getElementById('innings2Scorecard');
    const srInnings2Team = document.getElementById('sr_innings2Team');
    const srInnings2Score = document.getElementById('sr_innings2Score');
    const srInnings2Wickets = document.getElementById('sr_innings2Wickets');
    const srInnings2Overs = document.getElementById('sr_innings2Overs');
    const srInnings2Batting = document.getElementById('sr_innings2Batting');
    const srInnings2Bowling = document.getElementById('sr_innings2Bowling');
    const srInnings2FOW = document.getElementById('sr_innings2FOW');

    const finalMatchResultSpan = document.getElementById('finalMatchResult');
    const manOfTheMatchSpan = document.getElementById('manOfTheMatch');

    const battingTeamSection = document.getElementById('battingTeamSection');
    const bowlingTeamSection = document.getElementById('bowlingTeamSection');

     // Mapping English dismissal values to Urdu text for display
     const dismissalMethodsUrdu = {
        'Bold': 'بولڈ',
        'Lbw': 'ایل بی ڈبلیو',
        'Run Out': 'رن آؤٹ',
        'Stumped': 'اسٹمپڈ',
        'Caught': 'کیچ',
        'Hit Wicket': 'ہٹ وکٹ',
        'Obstructing the field': 'فیلڈ میں رکاوٹ',
        'Retired Hurt': 'ریٹائرڈ ہرٹ',
        '': 'نامعلوم', // For no dismissal
        'Not Out': 'ناٹ آؤٹ' // Translated 'Not Out'
    };


    // --- Helper Functions ---

    // Adds a player input field to a team's player list
    function addPlayerInput(teamPlayersDiv, teamPrefix) {
        const playerGroup = document.createElement('div');
        playerGroup.classList.add('player-input-group');
        const input = document.createElement('input');
        input.type = 'text';
        input.classList.add('player-name');
        // Use Urdu placeholder
        input.placeholder = `کھلاڑی ${teamPrefix} ${teamPlayersDiv.children.length + 1}`;
        const removeBtn = document.createElement('button');
        removeBtn.textContent = 'ہٹائیں'; // Translated
        removeBtn.classList.add('remove-player-btn');
        removeBtn.type = 'button'; // Prevent form submission
        removeBtn.onclick = function() {
            teamPlayersDiv.removeChild(playerGroup);
        };
        playerGroup.appendChild(input);
        playerGroup.appendChild(removeBtn);
        teamPlayersDiv.appendChild(playerGroup);
    }

    // Populates a select dropdown with player names
    function populatePlayerSelect(selectElement, players) {
        selectElement.innerHTML = '<option value="">کھلاڑی منتخب کریں</option>'; // Translated
        players.forEach(player => {
            const option = document.createElement('option');
            option.value = player;
            option.textContent = player;
            selectElement.appendChild(option);
        });
    }

    // Gets player names from a player list div
    function getPlayersFromDiv(teamPlayersDiv) {
        const players = [];
        teamPlayersDiv.querySelectorAll('.player-name').forEach(input => {
            const playerName = input.value.trim();
            if (playerName) {
                players.push(playerName);
            }
        });
        return players;
    }

    // Initializes player stats objects
    function initializePlayerStats(players) {
        const stats = {};
        players.forEach(player => {
            stats[player] = {
                runs: 0,
                balls: 0,
                overs: 0, // For bowlers
                wickets: 0, // For bowlers
                runsConceded: 0, // For bowlers
                dismissal: '', // For batsmen (stores English value)
                fielder: '' // For batsmen if caught/run out
            };
        });
        return stats;
    }

    // Updates the scoreboard display
    function updateScoreboard() {
        sbBattingScore.textContent = currentScore;
        sbWickets.textContent = currentWickets;

        // Format overs
        const currentBalls = (completedOvers * 6) + ballsInOver;
        const oversDisplay = completedOvers + '.' + ballsInOver;
        sbOversBowled.textContent = oversDisplay;

        // Update batsman scores
        if (currentBatsman1 && battingTeam.battingStats[currentBatsman1]) {
            sbBatsman1Name.textContent = currentBatsman1;
            sbBatsman1Score.textContent = battingTeam.battingStats[currentBatsman1].runs;
            sbBatsman1Balls.textContent = battingTeam.battingStats[currentBatsman1].balls;
        } else {
             sbBatsman1Name.textContent = 'دستیاب نہیں'; // Translated N/A
             sbBatsman1Score.textContent = 0;
             sbBatsman1Balls.textContent = 0;
        }
         if (currentBatsman2 && battingTeam.battingStats[currentBatsman2]) {
            sbBatsman2Name.textContent = currentBatsman2;
            sbBatsman2Score.textContent = battingTeam.battingStats[currentBatsman2].runs;
            sbBatsman2Balls.textContent = battingTeam.battingStats[currentBatsman2].balls;
        } else {
             sbBatsman2Name.textContent = 'دستیاب نہیں'; // Translated N/A
             sbBatsman2Score.textContent = 0;
             sbBatsman2Balls.textContent = 0;
        }


        // Update bowler stats
        if (currentBowler && bowlingTeam.bowlingStats[currentBowler]) {
            sbBowlerName.textContent = currentBowler;
             // Format bowler overs
            const bowlerBalls = (bowlingTeam.bowlingStats[currentBowler].overs * 6) + (bowlingTeam.bowlingStats[currentBowler].overs % 1 * 6); // Handle fractional overs
             const bowlerOversDisplay = Math.floor(bowlerBalls / 6) + '.' + (bowlerBalls % 6);
            sbBowlerOvers.textContent = bowlerOversDisplay;
            sbBowlerWickets.textContent = bowlingTeam.bowlingStats[currentBowler].wickets;
        } else {
             sbBowlerName.textContent = 'دستیاب نہیں'; // Translated N/A
             sbBowlerOvers.textContent = '0.0';
             sbBowlerWickets.textContent = 0;
        }


        // Calculate and update CRR
        const totalBallsBowled = (completedOvers * 6) + ballsInOver;
        const crr = totalBallsBowled > 0 ? (currentScore / totalBallsBowled) * 6 : 0;
        sbCrr.textContent = crr.toFixed(2);

        // Calculate and update RRR (if target is set)
        if (targetScore !== null) {
            rrrDisplay.style.display = 'block';
            const remainingRuns = targetScore - currentScore;
            const totalBallsInMatch = totalOvers * 6;
            const ballsRemaining = totalBallsInMatch - totalBallsBowled;
            const remainingOvers = ballsRemaining / 6;
            const rrr = remainingOvers > 0 ? remainingRuns / remainingOvers : 0;
            sbRrr.textContent = rrr.toFixed(2);
            // Update the separate target display
            sbTargetDisplay.textContent = targetScore;
            targetScoreDisplayDiv.style.display = 'block';


             // Check for match end conditions (target chased or overs/wickets exhausted)
             if (currentScore >= targetScore) {
                 // Match won by batting team
                 const wicketsRemaining = 10 - currentWickets;
                 const ballsRemainingAtEnd = totalBallsInMatch - totalBallsBowled;
                 const oversRemainingDisplay = Math.floor(ballsRemainingAtEnd / 6) + '.' + (ballsRemainingAtEnd % 6);
                 endMatch(`${battingTeam.name} نے ${wicketsRemaining} وکٹوں سے یہ میچ جیت لیا۔ ابھی ${oversRemainingDisplay} اوور باقی تھے۔`, battingTeam, bowlingTeam); // Translated result
             } else if (completedOvers >= totalOvers || currentWickets >= 10) {
                  // Match won by bowling team
                  const runsRemaining = targetScore - currentScore - 1; // Runs needed - runs scored - 1 (target)
                  endMatch(`${bowlingTeam.name} نے ${runsRemaining} رنز سے یہ میچ جیت لیا۔`, bowlingTeam, battingTeam); // Translated result
             }

        } else {
             rrrDisplay.style.display = 'none';
             targetScoreDisplayDiv.style.display = 'none'; // Hide target display if no target
        }

        // Update Fall of Wickets display
        fowList.innerHTML = '';
        fallOfWickets.forEach(fow => {
            const li = document.createElement('li');
            // Use translated dismissal method
            const dismissalMethodUrdu = dismissalMethodsUrdu[fow.method] || fow.method; // Use map or fallback
            li.textContent = `${fow.batsman} (${dismissalMethodUrdu}) - ${fow.score}/${fow.wickets} اوورز میں ${fow.overs}`; // Translated format
            fowList.appendChild(li);
        });
    }

    // Handles adding runs
    function addRuns(runs) {
        if (!currentBatsman1 || !currentBatsman2 || !currentBowler) {
            alert("براہ کرم دونوں بلے باز اور باؤلر منتخب کریں۔"); // Translated alert
            return;
        }

        // Determine the striker (assuming batsman1 is the striker for simplicity, could add a toggle)
        const striker = batsman1Select.value === currentBatsman1 ? currentBatsman1 : currentBatsman2;
        const nonStriker = striker === currentBatsman1 ? currentBatsman2 : currentBatsman1;

        currentScore += runs;
        battingTeam.battingStats[striker].runs += runs;
        battingTeam.battingStats[striker].balls++;

        // Update bowler's runs conceded
        bowlingTeam.bowlingStats[currentBowler].runsConceded += runs;


        ballsInOver++;

        // If runs are odd, batsmen switch ends
        if (runs % 2 !== 0) {
             // Swap striker and non-striker for the next ball
            const temp = currentBatsman1;
            currentBatsman1 = currentBatsman2;
            currentBatsman2 = temp;
             // Update select dropdowns to reflect the change
             batsman1Select.value = currentBatsman1 || '';
             batsman2Select.value = currentBatsman2 || '';
        }


        checkOverEnd();
        updateScoreboard();
    }

     // Handles extras (No Ball, Wide)
     function addExtra(type) {
        if (!currentBowler) {
            alert("براہ کرم باؤلر منتخب کریں۔"); // Translated alert
            return;
        }
         currentScore += 1; // 1 run for the extra
         bowlingTeam.bowlingStats[currentBowler].runsConceded += 1; // Extra run added to bowler's runs

         if (type === 'noBall') {
             // No ball counts as a delivery but doesn't count towards the 6 balls
             // The bowler's overs/balls stat is updated when a legal delivery is bowled
             // For simplicity here, we just add the run and don't increment ballsInOver
         } else if (type === 'wide') {
             // Wide does not count as a delivery towards the over
             // The bowler's overs/balls stat is updated when a legal delivery is bowled
             // For simplicity here, we just add the run and don't increment ballsInOver
         }

         // If it's a wide or no-ball, the current over count doesn't increase, but the score does.
         // The ball count for the batsman is not incremented for extras.

         updateScoreboard();
     }


    // Handles wicket
    function recordWicket() {
        if (!currentBatsman1 || !currentBatsman2 || !currentBowler) {
            alert("براہ کرم دونوں بلے باز اور باؤلر منتخب کریں۔"); // Translated alert
            return;
        }
         // Show dismissal details form
         dismissalDetailsDiv.style.display = 'block';

         // Populate batsman out select (current batsmen)
         batsmanOutSelect.innerHTML = '<option value="">آؤٹ ہونے والا کھلاڑی منتخب کریں</option>'; // Translated
         if (currentBatsman1) {
             const option1 = document.createElement('option');
             option1.value = currentBatsman1;
             option1.textContent = currentBatsman1;
             batsmanOutSelect.appendChild(option1);
         }
          if (currentBatsman2) {
             const option2 = document.createElement('option');
             option2.value = currentBatsman2;
             option2.textContent = currentBatsman2;
             batsmanOutSelect.appendChild(option2);
         }

         // Populate fielder select (bowling team players)
         populatePlayerSelect(fielderSelect, bowlingTeam.players);
    }

     // Confirms and processes the wicket
     function confirmWicket() {
         const batsmanOutName = batsmanOutSelect.value;
         const dismissalMethod = dismissalMethodSelect.value; // This value is in English (e.g., 'Caught')
         const fielderName = fielderSelect.value;

         if (!batsmanOutName || !dismissalMethod) {
             alert("براہ کرم آؤٹ ہونے والا بلے باز اور آؤٹ ہونے کا طریقہ منتخب کریں۔"); // Translated alert
             return;
         }

         // Increment wickets
         currentWickets++;
         // Increment bowler's wickets
         if (currentBowler && bowlingTeam.bowlingStats[currentBowler]) {
             bowlingTeam.bowlingStats[currentBowler].wickets++;
         }

         // Update batsman's dismissal info
         if (battingTeam.battingStats[batsmanOutName]) {
             battingTeam.battingStats[batsmanOutName].dismissal = dismissalMethod; // Store English value for logic
             if (dismissalMethod === 'Caught' || dismissalMethod === 'Run Out') {
                 battingTeam.battingStats[batsmanOutName].fielder = fielderName;
             }
             // Increment balls faced for the batsman out (even if it's a dismissal delivery)
             battingTeam.battingStats[batsmanOutName].balls++;
         }


         // Record fall of wicket
         fallOfWickets.push({
             batsman: batsmanOutName,
             method: dismissalMethod, // Store English value
             score: currentScore,
             wickets: currentWickets,
             overs: completedOvers + '.' + ballsInOver
         });

         // Increment balls in over for a legal delivery wicket
         ballsInOver++;

         // Hide dismissal details form
         dismissalDetailsDiv.style.display = 'none';
         dismissalMethodSelect.value = '';
         fielderSelect.value = '';
         fielderSelectContainer.style.display = 'none';


         // Determine the new batsman to come in
         let newBatsman = null;
         const playedBatsmen = Object.keys(battingTeam.battingStats).filter(name => battingTeam.battingStats[name].balls > 0 || battingTeam.battingStats[name].dismissal !== '');
         const availableBatsmen = battingTeam.players.filter(player => !playedBatsmen.includes(player));

         if (availableBatsmen.length > 0) {
             // Find the next available batsman
             newBatsman = availableBatsmen[0];
              // Initialize stats for the new batsman if they haven't batted before
             if (!battingTeam.battingStats[newBatsman]) {
                 battingTeam.battingStats[newBatsman] = { runs: 0, balls: 0, dismissal: '', fielder: '' };
             }
         } else {
             // All players have batted or are out/retired
             newBatsman = null; // Or handle accordingly (e.g., declare innings closed)
         }


         // Update current batsmen based on who was out
         if (batsmanOutName === currentBatsman1) {
             currentBatsman1 = newBatsman;
         } else if (batsmanOutName === currentBatsman2) {
             currentBatsman2 = newBatsman;
         }

         // Update batsman selects
         populatePlayerSelect(batsman1Select, battingTeam.players);
         populatePlayerSelect(batsman2Select, battingTeam.players);
         batsman1Select.value = currentBatsman1 || '';
         batsman2Select.value = currentBatsman2 || '';


         checkOverEnd();
         updateScoreboard();

         // Check for all out
         if (currentWickets >= 10) {
             endInnings();
         }
     }


    // Checks if the over has ended
    function checkOverEnd() {
        if (ballsInOver === 6) {
            completedOvers++;
            ballsInOver = 0;

            // Bowler's over count is incremented
             if (currentBowler && bowlingTeam.bowlingStats[currentBowler]) {
                 bowlingTeam.bowlingStats[currentBowler].overs++;
             }

            // Batsmen switch ends at the end of the over
            const temp = currentBatsman1;
            currentBatsman1 = currentBatsman2;
            currentBatsman2 = temp;

             // Update select dropdowns to reflect the change
             populatePlayerSelect(batsman1Select, battingTeam.players);
             populatePlayerSelect(batsman2Select, battingTeam.players);
             batsman1Select.value = currentBatsman1 || '';
             batsman2Select.value = currentBatsman2 || '';


            // Check for end of match (if total overs reached)
            if (completedOvers >= totalOvers && currentInnings === 2) {
                 // Match ends if 2nd innings overs are completed and target not reached
                 const runsRemaining = targetScore - currentScore - 1;
                 endMatch(`${bowlingTeam.name} نے ${runsRemaining} رنز سے یہ میچ جیت لیا۔`, bowlingTeam, battingTeam); // Translated result
            } else if (completedOvers >= totalOvers || currentWickets >= 10) {
                 // Match won by bowling team
                 const runsRemaining = targetScore - currentScore - 1; // Runs needed - runs scored - 1 (target)
                 endMatch(`${bowlingTeam.name} نے ${runsRemaining} رنز سے یہ میچ جیت لیا۔`, bowlingTeam, battingTeam); // Translated result
            }

        }
    }

    // Ends the current innings
    function endInnings() {
        if (currentInnings === 1) {
            // Store Innings 1 data
            innings1Data = {
                 teamName: battingTeam.name,
                 score: currentScore,
                 wickets: currentWickets,
                 overs: completedOvers + '.' + ballsInOver,
                 battingStats: JSON.parse(JSON.stringify(battingTeam.battingStats)), // Deep copy
                 bowlingStats: JSON.parse(JSON.stringify(bowlingTeam.bowlingStats)), // Deep copy
                 fow: JSON.parse(JSON.stringify(fallOfWickets)) // Deep copy
            };

            // Set target for Innings 2
            targetScore = currentScore + 1;
            alert(`${battingTeam.name} اننگز ختم ہوگئی۔ ${bowlingTeam.name} کے لیے ہدف ${targetScore} ہے۔`); // Translated alert

            // Switch teams
            const tempTeam = battingTeam;
            battingTeam = bowlingTeam;
            bowlingTeam = tempTeam;

            // Reset scoreboard for Innings 2
            currentInnings = 2;
            currentScore = 0;
            currentWickets = 0;
            ballsInOver = 0;
            completedOvers = 0;
            currentBatsman1 = null;
            currentBatsman2 = null;
            currentBowler = null;
            fallOfWickets = [];

            // Update scoreboard team names and innings number
            sbInnings.textContent = currentInnings;
            sbBattingTeamName.textContent = battingTeam.name;
            sbBowlingTeamName.textContent = bowlingTeam.name;

             // Update team colors on scoreboard sections
            updateTeamColors();

            // Repopulate player selects for the new batting team
            populatePlayerSelect(batsman1Select, battingTeam.players);
            populatePlayerSelect(batsman2Select, battingTeam.players);
            // Repopulate bowler select for the new bowling team
            populatePlayerSelect(bowlerSelect, bowlingTeam.players);

             // Reset batsman and bowler displays
             sbBatsman1Name.textContent = 'دستیاب نہیں'; // Translated N/A
             sbBatsman1Score.textContent = 0;
             sbBatsman1Balls.textContent = 0;
             sbBatsman2Name.textContent = 'دستیاب نہیں'; // Translated N/A
             sbBatsman2Score.textContent = 0;
             sbBatsman2Balls.textContent = 0;
             sbBowlerName.textContent = 'دستیاب نہیں'; // Translated N/A
             sbBowlerOvers.textContent = '0.0';
             sbBowlerWickets.textContent = 0;

            updateScoreboard(); // Update display with reset values

        } else if (currentInnings === 2) {
            // Innings 2 ends, determine match result
            let resultText = "";
            if (currentScore >= targetScore) {
                const wicketsRemaining = 10 - currentWickets;
                const totalBallsBowled = (completedOvers * 6) + ballsInOver;
                const totalBallsInMatch = totalOvers * 6;
                const remainingBalls = totalBallsInMatch - totalBallsBowled;
                const remainingOversDisplay = Math.floor(remainingBalls / 6) + '.' + (remainingBalls % 6);
                 resultText = `${battingTeam.name} نے ${wicketsRemaining} وکٹوں سے یہ میچ جیت لیا۔ ابھی ${remainingOversDisplay} اوور باقی تھے۔`; // Translated result with overs remaining
            } else if (currentScore < targetScore - 1) {
                 const runsRemaining = targetScore - currentScore - 1;
                 resultText = `${bowlingTeam.name} نے ${runsRemaining} رنز سے یہ میچ جیت لیا۔`; // Translated result
            } else {
                 resultText = "میچ برابر ہو گیا!"; // Translated
            }
            endMatch(resultText, currentScore >= targetScore ? battingTeam : bowlingTeam, currentScore >= targetScore ? bowlingTeam : battingTeam);
        }
    }

    // Ends the match and displays the scorecard
    function endMatch(resultText, winningTeam, losingTeam) {
        // Hide scoreboard, show match result
        scoreboard.style.display = 'none';
        matchResultDiv.style.display = 'block';
        targetScoreDisplayDiv.style.display = 'none'; // Hide target display at the end of the match


        // Populate match details in the scorecard
        srMatchTitle.textContent = matchDetails.title;
        srGroundName.textContent = matchDetails.ground;
        srMatchDate.textContent = matchDetails.date;
        srMatchTime.textContent = matchDetails.time;
        srTotalOvers.textContent = matchDetails.totalOvers;
        srUmpireOnField1.textContent = matchDetails.umpire1;
        srUmpaireOnField2.textContent = matchDetails.umpire2; // Corrected ID
        srUmpireThird.textContent = matchDetails.umpire3;
        finalMatchResultSpan.textContent = resultText;

        // Determine Man of the Match (Simple heuristic: highest runs or most wickets)
        let bestPerformer = null;
        let bestScore = -1;
        let mostWickets = -1;
        let manOfTheMatch = "دستیاب نہیں"; // Translated N/A

        // Check batting performances from both innings
        const allBattingStats = { ...teamA.battingStats, ...teamB.battingStats };
        for (const player in allBattingStats) {
            if (allBattingStats[player].runs > bestScore) {
                bestScore = allBattingStats[player].runs;
                bestPerformer = player;
            } else if (allBattingStats[player].runs === bestScore && allBattingStats[player].balls < (bestPerformer ? allBattingStats[bestPerformer].balls : Infinity)) {
                 // Tie-breaker: fewer balls faced
                 bestPerformer = player;
            }
        }

        // Check bowling performances from both innings
        const allBowlingStats = { ...teamA.bowlingStats, ...teamB.bowlingStats };
         for (const player in allBowlingStats) {
            if (allBowlingStats[player].wickets > mostWickets) {
                mostWickets = allBowlingStats[player].wickets;
                // If this bowler has more wickets than the current best batsman's score, they are the new best performer
                 if (mostWickets > bestScore / 10) { // Simple weighting: 1 wicket ~ 10 runs
                     bestScore = -1; // Reset best score to prioritize wickets
                     bestPerformer = player;
                 } else if (mostWickets === (bestPerformer ? allBowlingStats[bestPerformer].wickets : -1) && allBowlingStats[player].runsConceded < (bestPerformer ? allBowlingStats[bestPerformer].runsConceded : Infinity)) {
                      // Tie-breaker: fewer runs conceded
                      bestPerformer = player;
                 }
            } else if (allBowlingStats[player].wickets === mostWickets && mostWickets > 0) {
                 // If tied on wickets, check runs conceded
                 if (allBowlingStats[player].runsConceded < (bestPerformer ? allBowlingStats[bestPerformer].runsConceded : Infinity)) {
                      bestPerformer = player;
                 }
            }
         }

        if (bestPerformer) {
            manOfTheMatch = bestPerformer;
        }
         manOfTheMatchSpan.textContent = `مین آف دی میچ: ${manOfTheMatch}`; // Translated


        // Populate Innings 1 Scorecard
        if (innings1Data) {
            srInnings1ScorecardDiv.classList.add(innings1Data.teamName === teamA.name ? 'team-a-color' : 'team-b-color');
            srInnings1Team.textContent = innings1Data.teamName;
            srInnings1Score.textContent = innings1Data.score;
            srInnings1Wickets.textContent = innings1Data.wickets;
            srInnings1Overs.textContent = innings1Data.overs;

            // Batting Stats
            srInnings1Batting.innerHTML = '';
            const innings1BattingTeamPlayers = innings1Data.teamName === teamA.name ? teamA.players : teamB.players;
            innings1BattingTeamPlayers.forEach(player => {
                 const stats = innings1Data.battingStats[player];
                 if (stats && (stats.runs > 0 || stats.balls > 0 || stats.dismissal)) {
                     const row = document.createElement('tr');
                     // Get Urdu dismissal method
                     const dismissalMethodUrdu = dismissalMethodsUrdu[stats.dismissal] || stats.dismissal || 'ناٹ آؤٹ'; // Use map or fallback, Translated 'Not Out'
                     row.innerHTML = `
                         <td>${player}</td>
                         <td>${stats.runs}</td>
                         <td>${stats.balls}</td>
                         <td>${dismissalMethodUrdu}</td>
                         <td>${stats.fielder || '-'}</td>
                     `;
                     srInnings1Batting.appendChild(row);
                 }
            });

             // Bowling Stats
             srInnings1Bowling.innerHTML = '';
             const innings1BowlingTeamPlayers = innings1Data.teamName === teamA.name ? teamB.players : teamA.players;
             innings1BowlingTeamPlayers.forEach(player => {
                 const stats = (innings1Data.teamName === teamA.name ? teamB : teamA).bowlingStats[player];
                  if (stats && (stats.overs > 0 || stats.wickets > 0 || stats.runsConceded > 0)) {
                     const row = document.createElement('tr');
                     // Format bowler overs for scorecard
                     const bowlerBalls = (stats.overs * 6) + (stats.overs % 1 * 6);
                     const bowlerOversDisplay = Math.floor(bowlerBalls / 6) + '.' + (bowlerBalls % 6);

                     row.innerHTML = `
                         <td>${player}</td>
                         <td>${bowlerOversDisplay}</td>
                         <td>${stats.wickets}</td>
                         <td>${stats.runsConceded}</td>
                     `;
                     srInnings1Bowling.appendChild(row);
                 }
             });


            // Fall of Wickets
            srInnings1FOW.innerHTML = '';
            innings1Data.fow.forEach(fow => {
                const li = document.createElement('li');
                 // Get Urdu dismissal method
                const dismissalMethodUrdu = dismissalMethodsUrdu[fow.method] || fow.method; // Use map or fallback
                li.textContent = `${fow.batsman} (${dismissalMethodUrdu}) - ${fow.score}/${fow.wickets} اوورز میں ${fow.overs}`; // Translated format
                srInnings1FOW.appendChild(li);
            });
        }

        // Populate Innings 2 Scorecard
         if (currentInnings === 2) {
             innings2ScorecardDiv.style.display = 'block';
             srInnings2ScorecardDiv.classList.add(battingTeam.name === teamA.name ? 'team-a-color' : 'team-b-color');
             srInnings2Team.textContent = battingTeam.name;
             srInnings2Score.textContent = currentScore;
             srInnings2Wickets.textContent = currentWickets;
             srInnings2Overs.textContent = completedOvers + '.' + ballsInOver;

             // Batting Stats
             srInnings2Batting.innerHTML = '';
             battingTeam.players.forEach(player => {
                 const stats = battingTeam.battingStats[player];
                  if (stats && (stats.runs > 0 || stats.balls > 0 || stats.dismissal)) {
                     const row = document.createElement('tr');
                      // Get Urdu dismissal method
                     const dismissalMethodUrdu = dismissalMethodsUrdu[stats.dismissal] || stats.dismissal || 'ناٹ آؤٹ'; // Use map or fallback, Translated 'Not Out'
                     row.innerHTML = `
                         <td>${player}</td>
                         <td>${stats.runs}</td>
                         <td>${stats.balls}</td>
                         <td>${dismissalMethodUrdu}</td>
                         <td>${stats.fielder || '-'}</td>
                     `;
                     srInnings2Batting.appendChild(row);
                 }
             });

             // Bowling Stats
             srInnings2Bowling.innerHTML = '';
             bowlingTeam.players.forEach(player => {
                 const stats = bowlingTeam.bowlingStats[player];
                 if (stats && (stats.overs > 0 || stats.wickets > 0 || stats.runsConceded > 0)) {
                     const row = document.createElement('tr');
                      // Format bowler overs for scorecard
                     const bowlerBalls = (stats.overs * 6) + (stats.overs % 1 * 6);
                     const bowlerOversDisplay = Math.floor(bowlerBalls / 6) + '.' + (bowlerBalls % 6);
                     row.innerHTML = `
                         <td>${player}</td>
                         <td>${bowlerOversDisplay}</td>
                         <td>${stats.wickets}</td>
                         <td>${stats.runsConceded}</td>
                     `;
                     srInnings2Bowling.appendChild(row);
                 }
             });

            // Fall of Wickets
            srInnings2FOW.innerHTML = '';
            fallOfWickets.forEach(fow => {
                const li = document.createElement('li');
                 // Get Urdu dismissal method
                const dismissalMethodUrdu = dismissalMethodsUrdu[fow.method] || fow.method; // Use map or fallback
                li.textContent = `${fow.batsman} (${dismissalMethodUrdu}) - ${fow.score}/${fow.wickets} اوورز میں ${fow.overs}`; // Translated format
                srInnings2FOW.appendChild(li);
            });
         }
    }

    // Updates the background color of the scoreboard sections based on the batting/bowling team
    function updateTeamColors() {
        // Remove existing color classes
        battingTeamSection.classList.remove('team-a-color', 'team-b-color');
        bowlingTeamSection.classList.remove('team-a-color', 'team-b-color');
         innings1ScorecardDiv.classList.remove('team-a-color', 'team-b-color'); // Also update scorecard sections
         innings2ScorecardDiv.classList.remove('team-a-color', 'team-b-color'); // Also update scorecard sections


        // Add color classes based on current teams
        if (battingTeam.name === teamA.name) {
            battingTeamSection.classList.add('team-a-color');
            bowlingTeamSection.classList.add('team-b-color');
             // Set initial colors for scorecard sections (needed when match starts)
            if (currentInnings === 1) {
                 innings1ScorecardDiv.classList.add('team-a-color');
            } else {
                 innings2ScorecardDiv.classList.add('team-a-color');
                 innings1ScorecardDiv.classList.add('team-b-color'); // Innings 1 was team B bowling
            }
        } else {
            battingTeamSection.classList.add('team-b-color');
            bowlingTeamSection.classList.add('team-a-color');
             // Set initial colors for scorecard sections (needed when match starts)
             if (currentInnings === 1) {
                 innings1ScorecardDiv.classList.add('team-b-color');
            } else {
                 innings2ScorecardDiv.classList.add('team-b-color');
                 innings1ScorecardDiv.classList.add('team-a-color'); // Innings 1 was team A bowling
            }
        }
    }


    // --- Event Listeners ---

    // Add player buttons
    addPlayerABtn.addEventListener('click', () => addPlayerInput(teamAPlayersDiv, 'الف')); // Pass prefix
    addPlayerBBtn.addEventListener('click', () => addPlayerInput(teamBPlayersDiv, 'با')); // Pass prefix

     // Event delegation for remove player buttons
    teamAPlayersDiv.addEventListener('click', function(event) {
        if (event.target.classList.contains('remove-player-btn')) {
            event.target.parentElement.remove();
        }
    });
     teamBPlayersDiv.addEventListener('click', function(event) {
        if (event.target.classList.contains('remove-player-btn')) {
            event.target.parentElement.remove();
        }
    });


    // Start Match button
    startMatchBtn.addEventListener('click', () => {
        // Get data from form
        matchDetails = {
            title: document.getElementById('matchTitle').value.trim(),
            ground: document.getElementById('groundName').value.trim(),
            date: document.getElementById('matchDate').value,
            time: document.getElementById('matchTime').value,
            totalOvers: parseInt(document.getElementById('totalOvers').value) || 0,
            umpire1: document.getElementById('umpireOnField1').value.trim(),
            umpire2: document.getElementById('umpireOnField2').value.trim(),
            umpire3: document.getElementById('umpireThird').value.trim()
        };

        teamA.name = document.getElementById('teamAName').value.trim();
        teamA.players = getPlayersFromDiv(teamAPlayersDiv);
        teamB.name = document.getElementById('teamBName').value.trim();
        teamB.players = getPlayersFromDiv(teamBPlayersDiv);
        totalOvers = matchDetails.totalOvers;

        // Validate data (basic check)
        if (!matchDetails.title || !teamA.name || teamA.players.length < 2 || !teamB.name || teamB.players.length < 2 || totalOvers <= 0) {
            alert("براہ کرم تمام مطلوبہ فیلڈز پُر کریں اور یقینی بنائیں کہ ہر ٹیم میں کم از کم 2 کھلاڑی ہیں۔"); // Translated alert
            return;
        }

        // Initialize player stats for both teams
        teamA.battingStats = initializePlayerStats(teamA.players);
        teamA.bowlingStats = initializePlayerStats(teamA.players); // All players can potentially bowl
        teamB.battingStats = initializePlayerStats(teamB.players);
        teamB.bowlingStats = initializePlayerStats(teamB.players); // All players can potentially bowl


        // Set initial batting and bowling teams (assuming Team A bats first, could add a toss)
        battingTeam = teamA;
        bowlingTeam = teamB;

        // Populate initial player selects on scoreboard
        populatePlayerSelect(batsman1Select, battingTeam.players);
        populatePlayerSelect(batsman2Select, battingTeam.players);
        populatePlayerSelect(bowlerSelect, bowlingTeam.players);


        // Update scoreboard initial details
        sbMatchTitle.textContent = matchDetails.title;
        sbGroundName.textContent = matchDetails.ground;
        sbMatchDate.textContent = matchDetails.date;
        sbMatchTime.textContent = matchDetails.time;
        sbTotalOvers.textContent = totalOvers;
        sbMatchTotalOvers.textContent = totalOvers;
        sbInnings.textContent = currentInnings;
        sbBattingTeamName.textContent = battingTeam.name;
        sbBowlingTeamName.textContent = bowlingTeam.name;

        // Set initial team colors
        updateTeamColors();


        // Hide form, show scoreboard
        preMatchForm.style.display = 'none';
        scoreboard.style.display = 'block';

        updateScoreboard(); // Initial display update
    });

    // Batsman selection change listeners
    batsman1Select.addEventListener('change', (event) => {
        currentBatsman1 = event.target.value;
        updateScoreboard();
    });
     batsman2Select.addEventListener('change', (event) => {
        currentBatsman2 = event.target.value;
         updateScoreboard();
    });

    // Bowler selection change listener
    bowlerSelect.addEventListener('change', (event) => {
        currentBowler = event.target.value;
        updateScoreboard();
    });

    // Run buttons
    runButtons.forEach(button => {
        button.addEventListener('click', (event) => {
            const runs = parseInt(event.target.dataset.runs);
            addRuns(runs);
        });
    });

    // Wicket button
    wicketBtn.addEventListener('click', recordWicket);

     // Confirm Wicket button
     confirmWicketBtn.addEventListener('click', confirmWicket);

     // Dismissal method select change listener (to show/hide fielder select)
     dismissalMethodSelect.addEventListener('change', (event) => {
         // Use English values for logic
         if (event.target.value === 'Caught' || event.target.value === 'Run Out') {
             fielderSelectContainer.style.display = 'block';
         } else {
             fielderSelectContainer.style.display = 'none';
         }
     });


    // Extras buttons
    noBallBtn.addEventListener('click', () => addExtra('noBall'));
    wideBtn.addEventListener('click', () => addExtra('wide'));

    // End Innings button
    endInningsBtn.addEventListener('click', endInnings);

    // --- Initial Setup ---
    // Set default date to today
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, '0'); // Month is 0-indexed
    const dd = String(today.getDate()).padStart(2, '0');
    document.getElementById('matchDate').value = `${yyyy}-${mm}-${dd}`;

     // Set default time to current time
     const now = new Date();
     const hours = String(now.getHours()).padStart(2, '0');
     const minutes = String(now.getMinutes()).padStart(2, '0');
     document.getElementById('matchTime').value = `${hours}:${minutes}`;


</script>

</body>
</html>
